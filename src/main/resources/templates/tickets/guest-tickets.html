<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>–ú–æ–∏ –±–∏–ª–µ—Ç—ã (–≥–æ—Å—Ç—å)</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>

<header class="topbar">
    <div class="brand">
        <a th:href="@{/}">Absolute cinema</a>
    </div>
    <nav>
        <a th:href="@{/movies}">–§–∏–ª—å–º—ã</a>
        <a th:href="@{/about}">–û –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–µ</a>
        <span th:if="${#authorization.expression('hasRole(''USER'')')}">
            <a th:href="@{/user/profile}">–ü—Ä–æ—Ñ–∏–ª—å</a>
            <a th:href="@{/user/favorites}">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
        </span>
        <span th:if="${#authorization.expression('isAnonymous()')}">
            <a th:href="@{/tickets/guest}">–ú–æ–∏ –±–∏–ª–µ—Ç—ã</a>
        </span>
        <span th:if="${#authorization.expression('hasRole(''ADMIN'')')}">
            <a th:href="@{/admin/movies}">–ê–¥–º–∏–Ω: –§–∏–ª—å–º—ã</a>
            <a th:href="@{/admin/screenings}">–ê–¥–º–∏–Ω: –°–µ–∞–Ω—Å—ã</a>
            <a th:href="@{/admin/users}">–ê–¥–º–∏–Ω: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
        </span>
    </nav>
    <div class="auth">
        <a th:if="${#authorization.expression('isAnonymous()')}"
           th:href="@{/login}">–í–æ–π—Ç–∏</a>

        <span th:if="${#authorization.expression('isAuthenticated()')}">
            <span th:text="${#authentication.name}">user</span>
            <form th:action="@{/logout}" method="post" class="inline">
                <button type="submit" class="link-button">–í—ã–π—Ç–∏</button>
            </form>
        </span>
        <button type="button" class="theme-toggle" onclick="toggleTheme()">
            üåô –¢—ë–º–Ω–∞—è
        </button>
    </div>
</header>

<main class="container booking-page">
    <h1>–ú–æ–∏ –±–∏–ª–µ—Ç—ã –±–µ–∑ –≤—Ö–æ–¥–∞ –≤ –∞–∫–∫–∞—É–Ω—Ç</h1>

    <section class="payment-section">
        <h2>–ù–∞–π—Ç–∏ –±–∏–ª–µ—Ç—ã –ø–æ e-mail</h2>

        <p class="hint">
            –£–∫–∞–∂–∏—Ç–µ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ—á—Ç—É, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –≤—ã –æ—Ñ–æ—Ä–º–ª—è–ª–∏ –ø–æ–∫—É–ø–∫—É.
            –ú—ã –ø–æ–∫–∞–∂–µ–º –≤—Å–µ –±—É–¥—É—â–∏–µ —Å–µ–∞–Ω—Å—ã —Å —ç—Ç–∏–º –∞–¥—Ä–µ—Å–æ–º.
        </p>

        <form method="get" th:action="@{/tickets/guest}" class="payment-form">
            <div class="form-group">
                <label for="email">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</label>
                <input id="email"
                       type="email"
                       name="email"
                       th:value="${email}"
                       placeholder="example@mail.com"
                       required>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">–ù–∞–π—Ç–∏ –±–∏–ª–µ—Ç—ã</button>
            </div>
        </form>

        <div th:if="${param.cancelled}" class="alert alert-success">
            –ë–∏–ª–µ—Ç —É—Å–ø–µ—à–Ω–æ –≤–æ–∑–≤—Ä–∞—â—ë–Ω. –î–µ–Ω—å–≥–∏ –±—É–¥—É—Ç –∑–∞—á–∏—Å–ª–µ–Ω—ã –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞.
        </div>
        <div th:if="${param.error}" class="alert alert-danger">
            –ù–µ —É–¥–∞–ª–æ—Å—å –≤–µ—Ä–Ω—É—Ç—å –±–∏–ª–µ—Ç. –í–æ–∑–º–æ–∂–Ω–æ, —Å–µ–∞–Ω—Å —É–∂–µ –Ω–∞—á–∞–ª—Å—è –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç.
        </div>
    </section>

    <section class="payment-section" th:if="${email != null and !#strings.isEmpty(email)}">
        <h2 th:text="'–ë–ª–∏–∂–∞–π—à–∏–µ –±–∏–ª–µ—Ç—ã –¥–ª—è ' + ${email}">–ë–∏–ª–µ—Ç—ã</h2>

        <div th:if="${#lists.isEmpty(tickets)}">
            <p>–ù–∞ —ç—Ç–æ—Ç –∞–¥—Ä–µ—Å –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤.</p>
        </div>

        <div th:if="${!#lists.isEmpty(tickets)}" class="qr-grid">
            <div class="qr-card" th:each="t : ${tickets}">
                <div class="qr-card__info">
                    <p>
                        <strong th:text="${t.screening.movie.title}">–§–∏–ª—å–º</strong><br/>
                        <span th:text="${#temporals.format(t.screening.startTime, 'dd.MM.yyyy HH:mm')}">
                            01.01.2025 19:00
                        </span><br/>
                        <span th:text="'–ó–∞–ª ' + ${t.screening.hall} + ', –º–µ—Å—Ç–æ ' + ${t.seat}">
                            –ó–∞–ª 1, –º–µ—Å—Ç–æ 1
                        </span>
                    </p>
                </div>

                <form th:action="@{/tickets/guest/cancel/{id}(id=${t.id})}"
                      method="post"
                      onsubmit="return confirm('–°–¥–∞—Ç—å —ç—Ç–æ—Ç –±–∏–ª–µ—Ç?');">
                    <input type="hidden" name="email" th:value="${email}">
                    <button type="submit" class="btn btn-secondary">
                        –°–¥–∞—Ç—å –±–∏–ª–µ—Ç
                    </button>
                </form>
            </div>
        </div>
    </section>
</main>
<script th:src="@{/js/theme.js}"></script>
</body>
</html>
