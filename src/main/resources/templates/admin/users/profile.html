<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>

<header class="topbar">
    <div class="brand">
        <a th:href="@{/}">Absolute cinema</a>
    </div>
    <nav>
        <a th:href="@{/movies}">–§–∏–ª—å–º—ã</a>
        <a th:href="@{/about}">–û –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–µ</a>
        <span th:if="${#authorization.expression('hasRole(''USER'')')}">
            <a th:href="@{/user/profile}">–ú–æ–∏ –±–∏–ª–µ—Ç—ã</a>
            <a th:href="@{/user/favorites}">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
        </span>
        <span th:if="${#authorization.expression('hasRole(''ADMIN'')')}">
            <a th:href="@{/admin/movies}">–ê–¥–º–∏–Ω</a>
        </span>
    </nav>
    <div class="auth">
        <a th:if="${#authorization.expression('isAnonymous()')}"
           th:href="@{/login}">–í–æ–π—Ç–∏</a>

        <span th:if="${#authorization.expression('isAuthenticated()')}">
            <span th:text="${#authentication.name}">user</span>
            <form th:action="@{/logout}" method="post" class="inline">
                <button type="submit" class="link-button">–í—ã–π—Ç–∏</button>
            </form>
        </span>
        <button type="button" class="theme-toggle" onclick="toggleTheme()">
            üåô –¢—ë–º–Ω–∞—è
        </button>
    </div>
</header>

<main class="container">
    <h1>–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h1>

    <div th:if="${param.booked}" class="alert alert-success">
        –£—Å–ø–µ—à–Ω–æ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ <span th:text="${param.booked}">0</span> –±–∏–ª–µ—Ç–æ–≤!
    </div>

    <div th:if="${param.updated}" class="alert alert-success">
        –ü—Ä–æ—Ñ–∏–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!
    </div>

    <div class="profile-layout">
        <section class="user-info-section">
            <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h2>
            <div class="user-card">
                <p><strong>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</strong> <span th:text="${user.username}">username</span></p>
                <p><strong>–ü–æ–ª–Ω–æ–µ –∏–º—è:</strong> <span th:text="${user.fullName != null ? user.fullName : '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}">Full Name</span></p>
                <p><strong>Email:</strong> <span th:text="${user.email != null ? user.email : '–ù–µ —É–∫–∞–∑–∞–Ω'}">email</span></p>
                <p th:if="${user.bio}"><strong>–û —Å–µ–±–µ:</strong> <span th:text="${user.bio}">Bio</span></p>

                <form th:action="@{/user/profile}" method="post" class="profile-form">
                    <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h3>
                    <div class="form-group">
                        <label>–ü–æ–ª–Ω–æ–µ –∏–º—è:</label>
                        <input type="text" name="fullName" th:value="${user.fullName}" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" name="email" th:value="${user.email}" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>–û —Å–µ–±–µ:</label>
                        <textarea name="bio" class="form-textarea" th:text="${user.bio}"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
                </form>
            </div>

            <section class="favorites-section" th:if="${not recentFavorites.empty}">
                <h2>–ù–µ–¥–∞–≤–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</h2>
                <div class="favorites-grid">
                    <div th:each="movie : ${recentFavorites}" class="favorite-card">
                        <h4 th:text="${movie.title}">–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞</h4>
                        <a th:href="@{/movies/{id}(id=${movie.id})}" class="btn btn-secondary btn-small">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                    </div>
                </div>
            </section>
        </section>

        <section class="tickets-section">
            <h2>–ë–ª–∏–∂–∞–π—à–∏–µ —Å–µ–∞–Ω—Å—ã</h2>
            <div th:if="${upcomingTickets.empty}">
                <p>–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Å–µ–∞–Ω—Å–æ–≤.</p>
                <a th:href="@{/movies}" class="btn btn-primary">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–∏–ª—å–º—ã</a>
            </div>
            <div th:unless="${upcomingTickets.empty}" class="tickets-grid">
                <div th:each="ticket : ${upcomingTickets}" class="ticket-card upcoming">
                    <div class="ticket-movie">
                        <h3 th:text="${ticket.screening.movie.title}">–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞</h3>
                        <p><strong>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:</strong>
                            <span th:text="${#temporals.format(ticket.screening.startTime, 'dd.MM.yyyy HH:mm')}">01.01.2025 19:00</span>
                        </p>
                        <p><strong>–ó–∞–ª:</strong> <span th:text="${ticket.screening.hall}">–ó–∞–ª 1</span></p>
                        <p><strong>–ú–µ—Å—Ç–æ:</strong> <span th:text="${ticket.seat}">1-1</span></p>
                        <p><strong>–¶–µ–Ω–∞:</strong> <span th:text="${ticket.screening.price}">500</span> —Ä—É–±.</p>
                    </div>
                    <div class="ticket-actions">
                        <a th:href="@{/movies/{id}(id=${ticket.screening.movie.id})}"
                           class="btn btn-secondary btn-small">–û —Ñ–∏–ª—å–º–µ</a>
                        <form th:action="@{/user/tickets/{id}/delete(id=${ticket.id})}"
                              method="post"
                              class="inline-form"
                              onsubmit="return confirm('–û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ?')">
                            <button type="submit" class="btn btn-danger btn-small">–û—Ç–º–µ–Ω–∏—Ç—å</button>
                        </form>
                    </div>
                </div>
            </div>

            <h2>–ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–µ—â–µ–Ω–∏–π</h2>
            <div th:if="${pastTickets.empty}">
                <p>–£ –≤–∞—Å –Ω–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Å–µ–∞–Ω—Å–æ–≤.</p>
            </div>
            <div th:unless="${pastTickets.empty}" class="tickets-grid">
                <div th:each="ticket : ${pastTickets}" class="ticket-card past">
                    <div class="ticket-movie">
                        <h3 th:text="${ticket.screening.movie.title}">–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞</h3>
                        <p><strong>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:</strong>
                            <span th:text="${#temporals.format(ticket.screening.startTime, 'dd.MM.yyyy HH:mm')}">01.01.2025 19:00</span>
                        </p>
                        <p><strong>–ó–∞–ª:</strong> <span th:text="${ticket.screening.hall}">–ó–∞–ª 1</span></p>
                        <p><strong>–ú–µ—Å—Ç–æ:</strong> <span th:text="${ticket.seat}">1-1</span></p>
                    </div>
                    <div class="ticket-actions">
                        <a th:href="@{/movies/{id}(id=${ticket.screening.movie.id})}"
                           class="btn btn-secondary btn-small">–û —Ñ–∏–ª—å–º–µ</a>
                    </div>
                </div>
            </div>
        </section>
    </div>
</main>
<script th:src="@{/js/favorites.js}"></script>
<script th:src="@{/js/theme.js}"></script>
</body>
</html>