<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>–ü—Ä–æ—Ñ–∏–ª—å</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>

<header class="topbar">
    <div class="brand"><a th:href="@{/}">Absolute cinema</a></div>
    <nav>
        <a th:href="@{/movies}">–§–∏–ª—å–º—ã</a>
        <a th:href="@{/about}">–û –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–µ</a>

        <span th:if="${#authorization.expression('isAnonymous()')}">
            <a th:href="@{/tickets/guest}">–ú–æ–∏ –±–∏–ª–µ—Ç—ã</a>
        </span>

        <span th:if="${#authorization.expression('hasRole(''USER'')')}">
            <a th:href="@{/user/profile}">–ü—Ä–æ—Ñ–∏–ª—å</a>
            <a th:href="@{/user/favorites}">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
        </span>
        <span th:if="${#authorization.expression('hasRole(''ADMIN'')')}">
            <a th:href="@{/admin/movies}">–ê–¥–º–∏–Ω: –§–∏–ª—å–º—ã</a>
            <a th:href="@{/admin/screenings}">–ê–¥–º–∏–Ω: –°–µ–∞–Ω—Å—ã</a>
            <a th:href="@{/admin/users}">–ê–¥–º–∏–Ω: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
        </span>
    </nav>
    <div class="auth">
        <a th:if="${#authorization.expression('isAnonymous()')}"
           th:href="@{/login}">–í–æ–π—Ç–∏</a>
        <span th:if="${#authorization.expression('isAuthenticated()')}">
            <span th:text="${#authentication.name}">user</span>
            <form th:action="@{/logout}" method="post" class="inline">
                <button type="submit" class="link-button">–í—ã–π—Ç–∏</button>
            </form>
        </span>
        <button type="button" class="theme-toggle" onclick="toggleTheme()">
            üåô –¢—ë–º–Ω–∞—è
        </button>
    </div>
</header>

<main class="container booking-page">
    <h1>–ü—Ä–æ—Ñ–∏–ª—å</h1>

    <!-- –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
    <section class="payment-section">
        <h2>–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>

        <form th:action="@{/user/profile}" method="post" class="payment-form">
            <div class="form-group">
                <label>–õ–æ–≥–∏–Ω</label>
                <input type="text" th:value="${user.username}" disabled>
            </div>

            <div class="form-group">
                <label for="fullName">–ò–º—è</label>
                <input id="fullName" type="text" name="fullName"
                       th:value="${user.fullName}">
            </div>

            <div class="form-group">
                <label for="email">E-mail</label>
                <input id="email" type="email" name="email"
                       th:value="${user.email}">
            </div>

            <div class="form-group">
                <label for="bio">–û —Å–µ–±–µ</label>
                <textarea id="bio" name="bio" rows="3"
                          th:text="${user.bio}"></textarea>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </form>
    </section>

    <!-- –ë–ª–∏–∂–∞–π—à–∏–µ —Å–µ–∞–Ω—Å—ã —Å QR -->
    <section class="payment-section">
        <h2>–ë–ª–∏–∂–∞–π—à–∏–µ —Å–µ–∞–Ω—Å—ã</h2>

        <div th:if="${#lists.isEmpty(upcomingTickets)}">
            <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤.</p>
        </div>

        <div th:if="${!#lists.isEmpty(upcomingTickets)}" class="qr-grid">
            <div class="qr-card" th:each="t : ${upcomingTickets}">
                <div class="qr-card__info">
                    <p>
                        <strong th:text="${t.screening.movie.title}">–§–∏–ª—å–º</strong><br/>
                        <span th:text="${#temporals.format(t.screening.startTime, 'dd.MM.yyyy HH:mm')}">
                            01.01.2025 19:00
                        </span><br/>
                        <span th:text="'–ó–∞–ª ' + ${t.screening.hall} + ', –º–µ—Å—Ç–æ ' + ${t.seat}">
                            –ó–∞–ª 1, –º–µ—Å—Ç–æ 1
                        </span><br/>
                        <span th:text="'–ò–º—è: ' + ${t.customerName}">–ò–º—è</span>
                    </p>
                </div>

                <div class="qr-card__image">
                    <img th:src="@{/tickets/qr/{id}(id=${t.id})}"
                         alt="QR-–∫–æ–¥ –±–∏–ª–µ—Ç–∞">
                </div>

                <form th:action="@{/user/tickets/{id}/delete(id=${t.id})}"
                      method="post"
                      onsubmit="return confirm('–°–¥–∞—Ç—å —ç—Ç–æ—Ç –±–∏–ª–µ—Ç?');">
                    <button type="submit" class="btn btn-secondary">
                        –°–¥–∞—Ç—å –±–∏–ª–µ—Ç
                    </button>
                </form>
            </div>
        </div>
    </section>

    <!-- –ü—Ä–æ—à–µ–¥—à–∏–µ —Å–µ–∞–Ω—Å—ã -->
    <section class="payment-section">
        <h2>–ü—Ä–æ—à–µ–¥—à–∏–µ —Å–µ–∞–Ω—Å—ã</h2>

        <div th:if="${#lists.isEmpty(pastTickets)}">
            <p>–ü–æ–∫–∞ –µ—â—ë –Ω–µ –±—ã–ª–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ –ø—Ä–æ—à–µ–¥—à–µ–≥–æ —Å–µ–∞–Ω—Å–∞.</p>
        </div>

        <div th:if="${!#lists.isEmpty(pastTickets)}">
            <ul>
                <li th:each="t : ${pastTickets}">
                    <strong th:text="${t.screening.movie.title}">–§–∏–ª—å–º</strong>,
                    <span th:text="${#temporals.format(t.screening.startTime, 'dd.MM.yyyy HH:mm')}">
                        01.01.2025 19:00
                    </span>,
                    <span th:text="'–ó–∞–ª ' + ${t.screening.hall} + ', –º–µ—Å—Ç–æ ' + ${t.seat}">
                        –ó–∞–ª 1, –º–µ—Å—Ç–æ 1
                    </span>
                </li>
            </ul>
        </div>
    </section>

    <!-- –ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å–º—ã -->
    <section class="payment-section">
        <h2>–ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å–º—ã</h2>

        <div th:if="${#lists.isEmpty(recentFavorites)}">
            <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤.</p>
        </div>

        <div th:if="${!#lists.isEmpty(recentFavorites)}" class="movies-grid">
            <div class="movie-card" th:each="m : ${recentFavorites}">
                <div class="movie-poster">
                    <img th:if="${m.posterUrl != null}"
                         th:src="${m.posterUrl}" alt="–ü–æ—Å—Ç–µ—Ä">
                    <div th:if="${m.posterUrl == null}"
                         class="movie-poster-placeholder">–ù–ï–¢ –ü–û–°–¢–ï–†–ê</div>
                </div>
                <div class="movie-content">
                    <h3 th:text="${m.title}">–ù–∞–∑–≤–∞–Ω–∏–µ</h3>
                    <p class="movie-genre" th:text="${m.genre}">–ñ–∞–Ω—Ä</p>
                </div>
                <div class="movie-footer">
                    <a class="btn btn-primary"
                       th:href="@{/movies/{id}(id=${m.id})}">
                        –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                    </a>
                </div>
            </div>
        </div>
    </section>
</main>
<script th:src="@{/js/theme.js}"></script>
</body>
</html>
