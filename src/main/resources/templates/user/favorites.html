<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>–ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å–º—ã</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>

<header class="topbar">
    <div class="brand">
        <a th:href="@{/}">Absolute cinema</a>
    </div>
    <nav>
        <a th:href="@{/movies}">–§–∏–ª—å–º—ã</a>
        <a th:href="@{/about}">–û –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–µ</a>

        <!-- –î–ª—è –≥–æ—Å—Ç–µ–π: –ú–æ–∏ –±–∏–ª–µ—Ç—ã –ø–æ e-mail -->
        <span th:if="${#authorization.expression('isAnonymous()')}">
            <a th:href="@{/tickets/guest}">–ú–æ–∏ –±–∏–ª–µ—Ç—ã</a>
        </span>

        <!-- –î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö: –ø—Ä–æ—Ñ–∏–ª—å –∏ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ -->
        <span th:if="${#authorization.expression('hasRole(''USER'')')}">
            <a th:href="@{/user/profile}">–ü—Ä–æ—Ñ–∏–ª—å</a>
            <a th:href="@{/user/favorites}">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
        </span>

        <span th:if="${#authorization.expression('hasRole(''ADMIN'')')}">
            <a th:href="@{/admin/movies}">–ê–¥–º–∏–Ω: –§–∏–ª—å–º—ã</a>
            <a th:href="@{/admin/screenings}">–ê–¥–º–∏–Ω: –°–µ–∞–Ω—Å—ã</a>
            <a th:href="@{/admin/users}">–ê–¥–º–∏–Ω: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
        </span>
    </nav>
    <div class="auth">
        <a th:if="${#authorization.expression('isAnonymous()')}"
           th:href="@{/login}">–í–æ–π—Ç–∏</a>

        <span th:if="${#authorization.expression('isAuthenticated()')}">
            <span th:text="${#authentication.name}">user</span>
            <form th:action="@{/logout}" method="post" class="inline">
                <button type="submit" class="link-button">–í—ã–π—Ç–∏</button>
            </form>
        </span>
        <button type="button" class="theme-toggle" onclick="toggleTheme()">
            üåô –¢—ë–º–Ω–∞—è
        </button>
    </div>
</header>

<main class="container booking-page">
    <h1>–ò–∑–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∏–ª—å–º—ã</h1>

    <div th:if="${#lists.isEmpty(favorites)}">
        –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å–º–æ–≤.
    </div>

    <div th:if="${!#lists.isEmpty(favorites)}" class="movies-grid">
        <div class="movie-card" th:each="movie : ${favorites}">
            <div class="movie-poster">
                <img th:if="${movie.posterUrl != null}"
                     th:src="${movie.posterUrl}" alt="–ü–æ—Å—Ç–µ—Ä">
                <div th:if="${movie.posterUrl == null}"
                     class="movie-poster-placeholder">
                    –ù–ï–¢ –ü–û–°–¢–ï–†–ê
                </div>
            </div>

            <div class="movie-content">
                <h3 th:text="${movie.title}">–ù–∞–∑–≤–∞–Ω–∏–µ</h3>
                <p class="movie-genre" th:text="${movie.genre}">–ñ–∞–Ω—Ä</p>

                <!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –ø–æ–ª–µ description –∏ —Å–æ–∫—Ä–∞—â–∞–µ–º -->
                <p class="movie-desc"
                   th:text="${#strings.abbreviate(movie.description, 120)}">
                    –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
                </p>
            </div>

            <div class="movie-footer">
                <a class="btn btn-secondary"
                   th:href="@{/movies/{id}(id=${movie.id})}">
                    –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                </a>

                <!-- –ö–Ω–æ–ø–∫–∞ "–£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ" -->
                <form th:action="@{/user/favorites/{id}/toggle(id=${movie.id})}"
                      method="post"
                      class="inline">
                    <button type="submit" class="btn btn-secondary btn-small">
                        –£–±—Ä–∞—Ç—å
                    </button>
                </form>
            </div>
        </div>
    </div>
</main>
<script th:src="@{/js/theme.js}"></script>
</body>
</html>
