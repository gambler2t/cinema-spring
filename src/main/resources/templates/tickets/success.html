<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>–ë–∏–ª–µ—Ç—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω—ã</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>

<header class="topbar">
    <div class="brand">
        <a th:href="@{/}">Absolute cinema</a>
    </div>
    <nav>
        <a th:href="@{/movies}">–§–∏–ª—å–º—ã</a>
        <a th:href="@{/about}">–û –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–µ</a>
        <span th:if="${#authorization.expression('hasRole(''USER'')')}">
            <a th:href="@{/user/profile}">–ü—Ä–æ—Ñ–∏–ª—å</a>
            <a th:href="@{/user/favorites}">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</a>
        </span>
        <span th:if="${#authorization.expression('isAnonymous()')}">
            <a th:href="@{/tickets/guest}">–ú–æ–∏ –±–∏–ª–µ—Ç—ã</a>
        </span>
        <span th:if="${#authorization.expression('hasRole(''ADMIN'')')}">
            <a th:href="@{/admin/movies}">–ê–¥–º–∏–Ω: –§–∏–ª—å–º—ã</a>
            <a th:href="@{/admin/screenings}">–ê–¥–º–∏–Ω: –°–µ–∞–Ω—Å—ã</a>
            <a th:href="@{/admin/users}">–ê–¥–º–∏–Ω: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</a>
        </span>
    </nav>
    <div class="auth">
        <a th:if="${#authorization.expression('isAnonymous()')}"
           th:href="@{/login}">–í–æ–π—Ç–∏</a>

        <span th:if="${#authorization.expression('isAuthenticated()')}">
            <span th:text="${#authentication.name}">user</span>
            <form th:action="@{/logout}" method="post" class="inline">
                <button type="submit" class="link-button">–í—ã–π—Ç–∏</button>
            </form>
        </span>
        <button type="button" class="theme-toggle" onclick="toggleTheme()">
            üåô –¢—ë–º–Ω–∞—è
        </button>
    </div>
</header>

<main class="container booking-page">
    <h1>–ü–æ–∫—É–ø–∫–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞</h1>

    <section class="ticket-screening-info">
        <p><span class="tag">–§–∏–ª—å–º:</span>
            <strong th:text="${screening.movie.title}">–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞</strong></p>
        <p><span class="tag">–ù–∞—á–∞–ª–æ:</span>
            <span th:text="${#temporals.format(screening.startTime, 'dd.MM.yyyy HH:mm')}"></span></p>
        <p><span class="tag">–ó–∞–ª:</span>
            <span th:text="${screening.hall}"></span></p>
        <p>
            <span class="tag">–ë–∏–ª–µ—Ç–æ–≤:</span>
            <strong th:text="${ticketsCount}">0</strong>
            &nbsp;&nbsp;
            <span class="tag">–ò—Ç–æ–≥–æ –æ–ø–ª–∞—á–µ–Ω–æ:</span>
            <strong th:text="${#numbers.formatDecimal(totalPrice, 1, 2)}">0.00</strong> —Ä—É–±.
        </p>
        <p th:if="${emailUsed != null}">
            –ë–∏–ª–µ—Ç—ã —Ç–∞–∫–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ e-mail:
            <strong th:text="${emailUsed}">mail@example.com</strong>
        </p>
    </section>

    <section class="qr-section">
        <h2>–í–∞—à–∏ QR-–∫–æ–¥—ã</h2>
        <p>–ü–æ–∫–∞–∂–∏—Ç–µ –ª—é–±–æ–π –∏–∑ —ç—Ç–∏—Ö QR-–∫–æ–¥–æ–≤ –∫–æ–Ω—Ç—Ä–æ–ª—ë—Ä—É –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ –∑–∞–ª.</p>

        <div class="qr-grid">
            <div class="qr-card" th:each="t : ${tickets}">
                <div class="qr-card__info">
                    <p>
                        <strong th:text="'–ú–µ—Å—Ç–æ: ' + ${t.seat}">–†—è–¥ 1, –º–µ—Å—Ç–æ 1</strong><br/>
                        <span th:text="${t.customerName}">–ò–º—è</span>
                    </p>
                </div>
                <div class="qr-card__image">
                    <img th:src="'data:image/png;base64,' + ${qrCodes[t.id]}"
                         alt="QR-–∫–æ–¥ –±–∏–ª–µ—Ç–∞">
                </div>
            </div>
        </div>
    </section>

    <section class="ticket-form-section">
        <div class="form-actions">
            <a th:href="@{/movies}" class="btn btn-primary">–ö —Ñ–∏–ª—å–º–∞–º</a>

            <a th:if="${#authorization.expression('hasRole(''USER'')')}"
               th:href="@{/user/profile}"
               class="btn btn-secondary">–í –ø—Ä–æ—Ñ–∏–ª—å</a>

            <a th:if="${emailUsed != null and !#strings.isEmpty(emailUsed) and
                       #authorization.expression('isAnonymous()')}"
               th:href="@{/tickets/guest(email=${emailUsed})}"
               class="btn btn-outline">
                –£–ø—Ä–∞–≤–ª—è—Ç—å –±–∏–ª–µ—Ç–∞–º–∏ –ø–æ e-mail
            </a>
        </div>
    </section>
</main>
<script th:src="@{/js/theme.js}"></script>
</body>
</html>
